<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lexus GX 460 Archival Dashboard — JTJBM7FX0D5051070</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap');
    
    body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }

    /* preserve key highlight colors for PDF export */
    html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    .service-viewport::-webkit-scrollbar { width: 6px; }
    .service-viewport::-webkit-scrollbar-track { background: #f8fafc; }
    .service-viewport::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    .timeline-line::before {
      content: '';
      position: absolute;
      left: 0.75rem;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: #f1f5f9;
    }

    @media print {
      body { background: white !important; padding: 0 !important; }
      .no-print { display: none !important; }
      .print-shadow { box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
      .print-break { break-inside: avoid; page-break-inside: avoid; }
      .service-viewport { max-height: none !important; overflow: visible !important; }
      .timeline-line::before { background-color: #e2e8f0 !important; }
      a { color: #0f172a !important; text-decoration: none !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 selection:bg-blue-100 text-[15px] sm:text-[16px]">

  <!-- Navigation -->
  <nav class="sticky top-0 z-50 bg-white/85 backdrop-blur-md border-b border-slate-200 no-print">
    <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-2" title="Verified by Physical Records">
        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" aria-hidden="true"></div>
        <span class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-500">Archive Status: Verified</span>
        </div>
      <div class="flex items-center gap-3">
        <button onclick="copyVIN()" class="text-[11px] font-mono bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-md transition-colors flex items-center gap-2 border border-slate-200">
          <i data-lucide="copy" class="w-3.5 h-3.5"></i> <span id="vin-text">JTJBM7FX0D5051070</span>
        </button>
        <button onclick="exportReport()" class="bg-slate-900 text-white text-[11px] font-bold uppercase tracking-wider px-4 py-1.5 rounded-md hover:bg-slate-800 transition-all flex items-center gap-2 shadow-lg shadow-slate-900/20">
          <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Export Report
        </button>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto px-4 py-8 md:py-10">
    
    <!-- Hero / Identification -->
    <header class="mb-8 bg-white rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-200 print-shadow relative overflow-hidden">
      <div class="flex flex-col lg:flex-row">
        <div class="lg:w-2/5 bg-white flex items-center justify-center p-4 border-b lg:border-b-0 lg:border-r border-slate-100">
          <img src="assets/images/cc_2013lex005a_01_640_202.jpg" alt="Lexus GX 460 Front Profile" class="w-full h-auto object-contain" />
        </div>
        
        <div class="lg:w-3/5 p-8 md:p-10 flex flex-col justify-between">
          <div>
            <div class="flex flex-wrap items-center gap-2 mb-4">
              <div class="inline-flex items-center gap-2 bg-blue-50 border border-blue-100 text-blue-700 px-3 py-1 rounded-full">
                <i data-lucide="shield-check" class="w-3.5 h-3.5 text-blue-600" title="Verified by Physical Records"></i>
                <span class="text-[9px] font-extrabold uppercase tracking-widest leading-none text-blue-900">Lexus Certified Records Export</span>
              </div>

              <!-- Print-visible verification indicator (nav is hidden on print) -->
              <div class="inline-flex items-center gap-2 bg-emerald-50 border border-emerald-100 text-emerald-800 px-3 py-1 rounded-full" title="Verified by Physical Records">
                <span class="inline-block w-2 h-2 bg-emerald-500 rounded-full animate-pulse" aria-hidden="true"></span>
                <span class="text-[9px] font-extrabold uppercase tracking-widest leading-none">Archive Status: Verified</span>
              </div>
            </div>

            <h1 class="text-3xl md:text-5xl font-black text-slate-900 tracking-tight leading-none mb-4 flex items-center">
              <img src="assets/icons/lexus-1.svg" alt="Lexus Emblem" class="h-6 w-auto opacity-80 mr-3 align-middle" />
              <span>2013 Lexus GX 460</span>
            </h1>
            <div class="flex flex-wrap items-center gap-y-2 gap-x-4 text-slate-500 font-medium text-sm">
              <span class="flex items-center gap-1.5">
                <img src="assets/icons/japan-flag.svg" alt="Japan Flag" class="w-4 h-4 rounded-sm shadow-sm object-cover align-middle" />
                Tahara Plant, Aichi (JP)
              </span>
              <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
              <span class="flex items-center gap-1.5 font-mono">1UR-FE 4.6L V8</span>
              <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
              <span class="flex items-center gap-1.5 uppercase text-[11px] tracking-widest">J150 Platform</span>
            </div>
          </div>

          <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-8">
            <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
              <p class="text-slate-400 text-[9px] uppercase font-bold tracking-widest mb-1 text-center">Odometer</p>
              <p class="text-2xl font-mono font-bold text-slate-900 text-center">121,600</p>
            </div>
            <div id="valuation-card" class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm">
              <div class="flex items-center justify-between">
                <p class="text-slate-400 text-[9px] uppercase font-bold tracking-widest">Valuation Matrix</p>
                <button
                  id="methodology-btn"
                  type="button"
                  class="no-print inline-flex items-center justify-center w-7 h-7 rounded-full bg-slate-100 hover:bg-slate-200 border border-slate-200 transition-colors"
                  aria-label="Valuation methodology"
                  aria-expanded="false"
                  title="Methodology"
                >
                  <i data-lucide="info" class="w-4 h-4 text-slate-600"></i>
                </button>
              </div>

              <div
                id="methodology-tooltip"
                class="no-print hidden mt-3 p-3 rounded-xl border border-slate-200 bg-white text-left shadow-lg shadow-slate-200/60"
                role="dialog"
                aria-label="Valuation methodology"
              >
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">Methodology (Private Party)</div>
                <div class="space-y-1 text-[12px] text-slate-700">
                  <div class="flex items-center justify-between gap-4">
                    <span class="text-slate-500">Base Private Party</span>
                    <span class="font-mono font-bold" id="baseline-base">$15,500</span>
                  </div>
                  <div class="flex items-center justify-between gap-4">
                    <span class="text-slate-500">Maintenance Premium</span>
                    <span class="font-mono font-bold" id="baseline-premium">+$2,000</span>
                  </div>
                  <div class="pt-2 mt-2 border-t border-slate-100 flex items-center justify-between gap-4">
                    <span class="font-semibold">Total (Index 1.00×)</span>
                    <span class="font-mono font-extrabold" id="baseline-total">$17,500</span>
        </div>
      </div>
    </div>

              <div class="grid grid-cols-3 gap-2 mt-4 mb-3">
                <div class="rounded-xl border border-slate-200 bg-white p-3">
                  <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Trade-In</div>
                  <div id="value-tradein" class="mt-1 text-lg md:text-xl font-mono font-bold text-slate-500">$13,200</div>
                  <div class="mt-1 text-[11px] text-slate-400">Liquidity Floor</div>
                </div>

                <div id="value-private-card" class="rounded-xl border-2 border-blue-300 bg-blue-50 p-3">
                  <div class="text-[10px] font-black uppercase tracking-widest text-blue-900">Private Party</div>
                  <div id="value-private" class="mt-1 text-xl md:text-2xl font-mono font-extrabold text-blue-700">$17,500</div>
                  <div class="mt-1 text-[11px] text-blue-700/80">Asset Target</div>
                </div>

                <div class="rounded-xl border border-slate-200 bg-white p-3">
                  <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Dealer Retail</div>
                  <div id="value-retail" class="mt-1 text-lg md:text-xl font-mono font-bold text-emerald-700">$21,500</div>
                  <div class="mt-1 text-[11px] text-slate-400">Replacement Cost</div>
                </div>
              </div>

              <p class="text-[10px] text-slate-500 text-center mt-1 font-mono">
                Market Index: <span id="market-adjustment-value">1.00×</span>
              </p>
            </div>
            <div class="hidden sm:block bg-slate-900 p-4 rounded-2xl text-white border border-slate-700">
              <p class="text-slate-500 text-[9px] uppercase font-bold tracking-widest mb-1 text-center">Status</p>
              <p class="text-center font-bold text-xs uppercase text-green-400">Above Average</p>
      </div>
        </div>

          <!-- Market Condition Adjuster (no-print) -->
          <div class="mt-6 no-print">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <i data-lucide="sliders-horizontal" class="w-4 h-4 text-slate-400" title="Adjusts the baseline for local market demand"></i>
                <span class="text-[11px] font-bold uppercase tracking-widest text-slate-600">Market Condition Adjuster</span>
              </div>
              <span class="text-[11px] font-mono text-slate-500" id="market-adjustment-label">1.00×</span>
            </div>
            <input
              id="market-adjustment"
              type="range"
              min="0.8"
              max="1.2"
              step="0.01"
              value="1.0"
              class="w-full accent-blue-600"
            />
            <div class="flex items-center justify-between mt-1 text-[10px] font-mono text-slate-400">
              <span>Buyer’s Market (Soft)</span>
              <span>Seller’s Market (High Demand)</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="flex flex-col lg:grid lg:grid-cols-12 lg:gap-8">
      
      <!-- Maintenance Log Column -->
      <div class="space-y-8 lg:col-span-8">

        <!-- Clinical Telemetry (Charts) -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6 print-hide-charts">
          <!-- Chart A: Annual Maintenance Spend -->
          <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <i data-lucide="bar-chart-3" class="w-4 h-4 text-blue-600"></i>
                <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Annual Maintenance Spend</h3>
              </div>
              <span class="text-[10px] font-mono text-slate-400">USD</span>
            </div>
            <div class="p-4">
              <div class="relative w-full">
                <canvas id="chart-annual-spend"></canvas>
              </div>
              <p class="mt-3 text-[11px] text-slate-500 font-mono">
                Outliers: <span class="text-slate-900 font-bold">2020</span> Head Unit • <span class="text-slate-900 font-bold">2023</span> Water Leak
              </p>
            </div>
          </div>

          <!-- Chart B: Mileage Accumulation Rate -->
          <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <i data-lucide="line-chart" class="w-4 h-4 text-blue-600"></i>
                <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Mileage Accumulation Rate</h3>
              </div>
              <span class="text-[10px] font-mono text-slate-400">ODOMETER</span>
            </div>
            <div class="p-4">
              <div class="relative w-full">
                <canvas id="chart-mileage"></canvas>
      </div>
        </div>
      </div>
    </section>

        <!-- Financial Telemetry (mobile) -->
        <section class="lg:hidden bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
          <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Financial Telemetry</h3>
            <i data-lucide="activity" class="w-4 h-4 text-slate-400" title="Computed from serviceHistory costs"></i>
          </div>
          <div class="p-6 space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Total Cost of Ownership (Maintenance)</span>
              <span data-telemetry="total" class="text-sm font-mono font-bold text-slate-900">$—</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Cost Per Mile</span>
              <span data-telemetry="cpm" class="text-sm font-mono font-bold text-slate-900">$—</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Annualized Maintenance Cost</span>
              <span data-telemetry="annual" class="text-sm font-mono font-bold text-slate-900">$—</span>
            </div>
            <div data-telemetry="meta" class="text-[11px] text-slate-400 pt-3 border-t border-slate-100"></div>
          </div>
        </section>

        <!-- Scrollable Archival Log -->
        <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden lg:overflow-visible print-shadow">
          <div class="bg-slate-50 px-8 py-5 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <i data-lucide="history" class="w-4 h-4 text-blue-600"></i>
              <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Comprehensive Service Archive (2013-2024)</h3>
      </div>
            <div class="flex items-center gap-3">
              <a href="assets/docs/Schedule%20Lexus%20Service%20Online%20%7C%20My%20Lexus.pdf" target="_blank" class="text-[9px] font-bold text-slate-600 hover:underline uppercase tracking-widest no-print">Service Export PDF</a>
              <a href="https://www.lexus.com/My-Lexus" target="_blank" class="text-[9px] font-bold text-blue-600 hover:underline uppercase tracking-widest no-print">Lexus Tech Portal</a>
        </div>
        </div>

          <div class="service-viewport p-8 relative h-auto lg:max-h-[calc(100vh-200px)] lg:overflow-y-auto lg:sticky lg:top-24">
            <div class="timeline-line absolute"></div>
            
            <div id="service-log" class="space-y-12"></div>
      </div>
    </section>

        <!-- Gallery Section -->
        <section class="hidden lg:block bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden no-print">
          <div class="bg-slate-50 px-8 py-5 border-b border-slate-100 flex items-center justify-between">
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Archival Image Verification</h3>
            <i data-lucide="camera" class="w-4 h-4 text-slate-400"></i>
          </div>
          <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="group relative bg-white rounded-xl overflow-hidden aspect-[4/3] flex items-center justify-center border border-slate-100">
              <img src="assets/images/cc_2013lex005a_640_202.jpg" alt="Side Profile" class="w-full h-auto object-contain transition-transform duration-500 group-hover:scale-105" />
              <div class="absolute bottom-3 left-3 bg-slate-900/60 backdrop-blur-md px-3 py-1 rounded-full border border-white/20">
                <span class="text-[10px] font-bold text-white uppercase tracking-widest">Side Profile</span>
              </div>
            </div>
            <div class="group relative bg-white rounded-xl overflow-hidden aspect-[4/3] flex items-center justify-center border border-slate-100">
              <img src="assets/images/cc_2013lex005a_02_640_202.jpg" alt="Rear Profile" class="w-full h-auto object-contain transition-transform duration-500 group-hover:scale-105" />
              <div class="absolute bottom-3 left-3 bg-slate-900/60 backdrop-blur-md px-3 py-1 rounded-full border border-white/20">
                <span class="text-[10px] font-bold text-white uppercase tracking-widest">Rear Profile</span>
              </div>
      </div>
      </div>
    </section>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-4 space-y-8 no-print">
        
        <!-- Technical Specifications (collapsible on mobile) -->
        <details id="specs-details" class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
          <summary class="bg-slate-50 px-6 py-4 border-b border-slate-100 cursor-pointer select-none list-none flex items-center justify-between">
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Technical Specifications</h3>
            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400"></i>
          </summary>
          <div class="p-4">
            <table class="w-full text-sm">
              <tbody class="[&>tr]:align-top [&>tr>td]:py-2 [&>tr>td]:px-2 [&>tr]:even:bg-slate-50">
                <tr class="bg-slate-900 text-white">
                  <td colspan="2" class="py-2 px-2 text-[10px] font-black uppercase tracking-[0.2em]">Powertrain</td>
                </tr>
                <tr>
                  <td class="text-slate-500 w-1/2">Engine</td>
                  <td class="font-semibold">1UR-FE 4.6L V8</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Transmission</td>
                  <td class="font-semibold">A760F 6-Speed</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Output</td>
                  <td class="font-semibold">301 HP / 329 TQ</td>
                </tr>
                <tr>
                  <td class="text-slate-500">4WD System</td>
                  <td class="font-semibold">Torsen® Limited Slip Center Differential (Type T-3)</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Final Drive Ratio</td>
                  <td class="font-mono font-bold">3.909</td>
                </tr>

                <tr class="bg-slate-900 text-white">
                  <td colspan="2" class="py-2 px-2 text-[10px] font-black uppercase tracking-[0.2em]">Dimensions</td>
                </tr>
                <tr>
                  <td class="text-slate-500">GVWR</td>
                  <td class="font-semibold">6,600 lbs</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Curb Weight</td>
                  <td class="font-semibold">5,128 lbs</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Paint Code</td>
                  <td class="font-mono font-bold">217 <span class="font-sans font-medium text-slate-500">(Starlight Black Mica)</span></td>
                </tr>

                <tr class="bg-slate-900 text-white">
                  <td colspan="2" class="py-2 px-2 text-[10px] font-black uppercase tracking-[0.2em]">Capacities</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Towing Max</td>
                  <td class="font-semibold">6,500 lbs</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Service Span</td>
                  <td class="font-semibold">2013 — 2024</td>
                </tr>
                <tr>
                  <td class="text-slate-500">Records Status</td>
                  <td class="font-semibold text-green-700">Certified Records</td>
                </tr>
              </tbody>
            </table>
          </div>
        </details>

        <!-- Financial Telemetry -->
        <section class="hidden lg:block bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
          <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Financial Telemetry</h3>
            <i data-lucide="activity" class="w-4 h-4 text-slate-400" title="Computed from serviceHistory costs"></i>
          </div>
          <div class="p-6 space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Total Cost of Ownership (Maintenance)</span>
              <span data-telemetry="total" class="text-sm font-mono font-bold text-slate-900">$—</span>
      </div>
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Cost Per Mile</span>
              <span data-telemetry="cpm" class="text-sm font-mono font-bold text-slate-900">$—</span>
      </div>
            <div class="flex items-center justify-between">
              <span class="text-xs text-slate-500">Annualized Maintenance Cost</span>
              <span data-telemetry="annual" class="text-sm font-mono font-bold text-slate-900">$—</span>
      </div>
            <div data-telemetry="meta" class="text-[11px] text-slate-400 pt-3 border-t border-slate-100"></div>
      </div>
    </section>

        <!-- Technical Library (collapsible on mobile) -->
        <details id="library-details" class="bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 shadow-2xl">
          <summary class="bg-slate-800 px-6 py-4 border-b border-slate-700 cursor-pointer select-none list-none flex items-center justify-between">
            <h3 class="text-xs font-bold text-white uppercase tracking-[0.2em] flex items-center gap-2">
              <i data-lucide="library" class="w-4 h-4 text-blue-400"></i> Technical Library
            </h3>
            <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400"></i>
          </summary>
          <div class="p-4 space-y-2">
            <a href="assets/docs/2013_lexus_gx_460_comprehensive_vehicle_overview_valuation.md" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Appraisal Summary (.md)</span>
              <i data-lucide="arrow-up-right" class="w-4 h-4 text-slate-500 group-hover:text-blue-400"></i>
            </a>
            <a href="assets/docs/Schedule%20Lexus%20Service%20Online%20%7C%20My%20Lexus.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Full Service Export (PDF)</span>
              <i data-lucide="download" class="w-4 h-4 text-slate-500 group-hover:text-green-400"></i>
            </a>
            <a href="assets/docs/2013_GX_460_Product_Info.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Full Factory Specs (PDF)</span>
              <i data-lucide="info" class="w-4 h-4 text-slate-500 group-hover:text-amber-400"></i>
            </a>
            <a href="assets/docs/OM60J63U%203.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Owner's Manual</span>
              <i data-lucide="book-open" class="w-4 h-4 text-slate-500 group-hover:text-white"></i>
            </a>
            <a href="assets/docs/OM60J67U%202.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Navigation Manual</span>
              <i data-lucide="map" class="w-4 h-4 text-slate-500 group-hover:text-blue-400"></i>
            </a>
            <a href="assets/docs/L-ADG-0035-D.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">Glass Breakage Security Guide</span>
              <i data-lucide="bell-ring" class="w-4 h-4 text-slate-400"></i>
            </a>
            <a href="assets/docs/2013-lexus-gx-brochure.pdf" target="_blank" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-all">
              <span class="text-[11px] font-semibold text-slate-200">2013 Factory Brochure</span>
              <i data-lucide="images" class="w-4 h-4 text-slate-400"></i>
            </a>
          </div>
        </details>

        <!-- Market Verification Tiles -->
        <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden no-print">
          <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">External Market Context</h3>
      </div>
          <div class="p-4 space-y-2">
            <a href="https://www.jdpower.com/cars/2013/lexus/gx" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">J.D. Power Ratings</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
            <a href="https://www.edmunds.com/lexus/gx-460/2013/review/" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">Edmunds Expert Review</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
            <a href="https://www.forbes.com/sites/jasonfogelson/2013/06/14/2013-lexus-gx-460-test-drive-and-review-driving-with-the-hobgoblin/" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">Forbes Reliability Report</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
            <a href="https://www.kbb.com/lexus/gx/2013/gx-460-sport-utility-4d/?vehicleid=378637&mileage=120000&offeroptions=true&modalview=false&intent=trade-in-sell&pricetype=trade-in&condition=verygood&options=6519800%7Ctrue&extcolor=black&subintent=curious&entry=defymmt" target="_blank" class="flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-xl transition-colors border border-blue-100">
              <span class="text-[11px] font-bold text-blue-800">KBB Trade-In Value (120k mi)</span>
              <i data-lucide="trending-up" class="w-3 h-3 text-blue-600"></i>
            </a>
            <a href="https://www.carmax.com/research/lexus/gx-460/2013" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">CarMax Research</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
            <a href="https://www.kbb.com/lexus/gx/2013/" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">KBB Model Overview</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
            <a href="https://www.carfax.com/Research-2013-Lexus-GX_z1486" target="_blank" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
              <span class="text-[11px] font-bold text-slate-700">Carfax History Context</span>
              <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
            </a>
      </div>
    </section>

      </div>
      </div>

    <!-- Legal Footer -->
    <footer class="mt-16 text-center border-t border-slate-200 pt-10">
      <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] mb-2">Automotive Archivist System</p>
      <p class="text-[11px] text-slate-400 font-medium italic">
        VIN <span class="font-mono">JTJBM7FX0D5051070</span> • Documented Origin: Lexus of Smithtown (2013) •
        <span class="inline-flex items-center">
          <img src="assets/icons/usa-flag.svg" alt="USA Flag" class="w-3 h-3 inline mr-1 opacity-80 align-middle" />
          US Market Spec
        </span>
      </p>
  </footer>

  </div>

  <script>
    // ============================================================
    // Service Archive: structured data (archival evidence)
    // ============================================================
    const currentOdometer = 121600;

    // Valuation baselines @ Market Index 1.0
    const baseValues = {
      tradeIn: 13200, // Wholesale/Liquidity Floor
      privateParty: 17500, // Core Asset Value (Target)
      dealerRetail: 21500, // Replacement Cost (Ceiling)
    };

    /** @type {Array<{
     *  date: string,
     *  mileage: number,
     *  type: "Routine" | "Repair" | "Upgrade" | "Critical",
     *  cost: number,
     *  notes: string,
     *  notesHtml?: string,
     *  title?: string,
     *  facility?: string,
     *  provider?: string,
     *  evidence?: boolean,
     *  observation?: string,
     *  correctiveAction?: string,
     *  valueNote?: string,
     *  archivalNote?: string,
     *  dotClass?: string,
     *  titleClass?: string,
     *  datePillClass?: string,
     *  displayDateLabel?: string,
     * }>} */
    const serviceHistory = [
      {
        date: "2024-08-29",
        mileage: 114900,
        type: "Routine",
        cost: 150.0,
        title: "Routine Service Record",
        facility: "Jiffy Lube",
        notes: "Miscellaneous service recorded.",
      },
      {
        date: "2023-08-29",
        mileage: 108112,
        type: "Critical",
        cost: 2400.0,
        title: "Water Intrusion Diagnosis & Remediation",
        provider: "New Country Lexus of Latham",
        evidence: true,
        observation:
          "Check Engine Light & 4x4 Low Light active. Found multiple codes for ECM communication loss. Discovered excessive water on passenger side dash/floor.",
        correctiveAction:
          "Removed interior to dry carpeting, padding, and sound deadening. Removed dash pad and harness. Found leak source within A-pillar. Cleaned/sealed area. Dried and verified ECUs and connectors.",
        archivalNote:
          "Archival note: this event is treated as primary disclosure evidence; see service export PDF for provenance.",
        notes:
          "Water intrusion event with multiple ECM communication loss codes; interior and harness dried; suspected A-pillar leak sealed; ECUs/connectors verified.",
        dotClass: "bg-amber-500",
        titleClass: "font-extrabold text-amber-900 text-xs uppercase tracking-wider",
        datePillClass:
          "text-[10px] font-mono bg-amber-50 text-amber-700 px-2 py-0.5 rounded font-bold tracking-tight",
      },
      {
        date: "2023-07-26",
        mileage: 107554,
        type: "Routine",
        cost: 850.0,
        title: "110,000 Mile Service Interval",
        notes:
          "Oil/filter replacement; tire rotation; NYS inspection. Major repair: rear brake pads and rotors replaced.",
        dotClass: "bg-green-500",
        titleClass: "font-bold text-slate-900 text-xs uppercase tracking-wider text-green-700",
      },
      {
        date: "2023-01-22",
        mileage: 103091,
        type: "Repair",
        cost: 650.0,
        title: "Park/Neutral Safety Switch Replacement",
        notes:
          "Replaced P/N Safety Switch (Part: 84540-35060). Adjusted and verified proper 4WD engagement/disengagement and vehicle starting.",
        notesHtml:
          '“Replaced P/N Safety Switch (Part: <span class="font-mono">84540-35060</span>). Adjusted and verified proper 4WD engagement/disengagement and vehicle starting.”',
        dotClass: "bg-blue-500",
        titleClass: "font-bold text-slate-900 text-xs uppercase tracking-wider text-blue-700",
      },
      {
        date: "2022-07-24",
        mileage: 97765,
        type: "Repair",
        cost: 1960.0,
        title: "Front Braking & Tire Overhaul",
        notes:
          "Replaced both front calipers, pads, and rotors. Mounted/balanced two 265/60R18 tires. Full system bleed.",
        dotClass: "bg-blue-500",
        titleClass: "font-bold text-xs uppercase tracking-wider text-blue-800",
      },
      {
        date: "2020-05-03",
        mileage: 81198,
        type: "Upgrade",
        cost: 1225.0,
        title: "Navigation/Audio Head Unit Replacement",
        evidence: true,
        valueNote: "Value: $1,225+",
        notes:
          "Inspected system circuits for power/ground. Internal failure diagnosed in navigation head unit. Factory replacement unit installed. Infotainment black-out resolved.",
        dotClass: "bg-blue-600",
        titleClass: "font-extrabold text-blue-900 text-xs uppercase tracking-wider",
        datePillClass:
          "text-[10px] font-mono bg-blue-50 text-blue-700 px-2 py-0.5 rounded font-black",
      },
      {
        date: "2018-01-18",
        mileage: 60960,
        type: "Routine",
        cost: 960.0,
        title: "60,000 Mile Major Service Milestone",
        notes:
          "Automatic transmission fluid flush and exchange. Cabin air filter, lubrication of drive shaft, brake fluid replacement, and battery replacement.",
        dotClass: "bg-green-600",
        titleClass: "font-extrabold text-slate-900 text-xs uppercase tracking-wider",
      },
      {
        // Summarized record: original log provides a range (2013–2015) rather than a single dated invoice.
        date: "2015-12-31",
        mileage: 30000,
        type: "Routine",
        cost: 850.0,
        title: "Standard Warranty-Era Maintenance",
        displayDateLabel: "2013 – 2015",
        notes:
          "Regular 5k, 10k, 15k, and 30k services performed at New Country Lexus. Remote starter diagnosed/repaired (24k mi).",
        dotClass: "bg-slate-300",
        titleClass: "font-bold text-slate-400 text-xs uppercase tracking-wider",
      },
      {
        date: "2013-07-01",
        mileage: 2,
        type: "Routine",
        cost: 0.0,
        title: "Pre-Delivery Service (PDI)",
        facility: "Lexus of Smithtown",
        notes:
          "Original vehicle registration and pre-delivery inspection for USA all altitudes.",
        dotClass: "bg-slate-900",
        datePillClass:
          "text-[10px] font-mono bg-slate-900 text-white px-2 py-0.5 rounded",
      },
    ];

    // ============================================================
    // Rendering helpers
    // ============================================================
    const usd0 = new Intl.NumberFormat("en-US", {
      style: "currency",
      currency: "USD",
      maximumFractionDigits: 0,
    });
    const usd2 = new Intl.NumberFormat("en-US", {
      style: "currency",
      currency: "USD",
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });

    function usdSmart(n) {
      const v = Number(n);
      if (!Number.isFinite(v)) return "$—";
      return Math.abs(v) < 100 ? usd2.format(v) : usd0.format(v);
    }

    function fmtMiles(n) {
      return Number(n).toLocaleString("en-US");
    }

    function fmtMonthYear(dateStr) {
      const d = new Date(`${dateStr}T00:00:00`);
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yyyy = String(d.getFullYear());
      return `${mm}/${yyyy}`;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function renderLog() {
      const container = document.getElementById("service-log");
      if (!container) return;

      const sorted = [...serviceHistory].sort(
        (a, b) => new Date(b.date) - new Date(a.date),
      );

      const defaultDatePill =
        "text-[10px] font-mono bg-slate-100 text-slate-600 px-2 py-0.5 rounded";

      container.innerHTML = sorted
        .map((e) => {
          const dateLabel = e.displayDateLabel
            ? e.displayDateLabel
            : `${fmtMonthYear(e.date)}`;
          const pill = e.datePillClass ?? defaultDatePill;
          const dot = e.dotClass ?? "bg-slate-400";
          const titleClass =
            e.titleClass ??
            "font-bold text-slate-900 text-xs uppercase tracking-wider";

          const evidenceBadge = e.evidence
            ? `
              <span class="inline-flex items-center gap-1 ${e.type === "Critical" ? "bg-amber-100 text-amber-900 border-amber-200" : "bg-blue-100 text-blue-900 border-blue-200"} border px-2 py-0.5 rounded-full text-[9px] font-black uppercase tracking-widest">
                <i data-lucide="badge-check" class="w-3 h-3"></i> Evidence
              </span>
            `
            : "";

          const meta = `${fmtMiles(e.mileage)} mi • ${dateLabel}`;

          const providerLine = e.facility
            ? `<p class="text-xs text-slate-500 uppercase tracking-tighter mb-1 font-bold">Facility: ${escapeHtml(e.facility)}</p>`
            : e.provider
              ? `<p class="text-[10px] text-slate-500 uppercase tracking-tighter mb-2 font-bold italic">Provider: ${escapeHtml(e.provider)}</p>`
              : "";

          const notesBlock =
            e.observation && e.correctiveAction
              ? `
                <div class="bg-amber-50 p-4 rounded-xl border border-amber-100 text-[13px] text-amber-900 leading-relaxed">
                  <p class="font-bold mb-1">Observation:</p>
                  “${escapeHtml(e.observation)}”
                  <p class="font-bold mt-2 mb-1">Corrective Action:</p>
                  “${escapeHtml(e.correctiveAction)}”
                </div>
                ${
                  e.archivalNote
                    ? `<p class="text-[11px] text-slate-500 mt-2">${escapeHtml(e.archivalNote)}</p>`
                    : ""
                }
              `
              : `<p class="text-[13px] text-slate-600 leading-relaxed">${
                  e.notesHtml ? e.notesHtml : escapeHtml(e.notes)
                }</p>`;

          const valueLine = e.valueNote
            ? `<p class="text-[13px] text-slate-600 font-medium mb-1">${escapeHtml(e.valueNote)}</p>`
            : "";

          // Keep the PDI note in monospaced, uppercase style like the original.
          const isPdi = e.title === "Pre-Delivery Service (PDI)";
          const pdiNotes = isPdi
            ? `<p class="text-[11px] text-slate-600 leading-relaxed uppercase font-mono">${escapeHtml(e.notes)}</p>`
            : "";

          return `
            <div class="relative pl-10 print-break">
              <span class="absolute left-1.5 top-1.5 w-3 h-3 ${dot} rounded-full border-2 border-white z-10"></span>
              <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-2">
                  <h4 class="${titleClass}">${escapeHtml(e.title ?? "")}</h4>
                  ${evidenceBadge}
                </div>
                <span class="${pill}">${escapeHtml(meta)}</span>
              </div>
              ${providerLine}
              ${valueLine}
              ${isPdi ? pdiNotes : notesBlock}
            </div>
          `;
        })
        .join("");
    }

    function renderTelemetry() {
      const totalEls = document.querySelectorAll('[data-telemetry="total"]');
      const cpmEls = document.querySelectorAll('[data-telemetry="cpm"]');
      const annualEls = document.querySelectorAll('[data-telemetry="annual"]');
      const metaEls = document.querySelectorAll('[data-telemetry="meta"]');
      if (!totalEls.length || !cpmEls.length || !annualEls.length || !metaEls.length) return;

      const total = serviceHistory.reduce((sum, e) => sum + (e.cost || 0), 0);
      const startMiles = Math.min(...serviceHistory.map((e) => e.mileage));
      const milesDriven = Math.max(1, currentOdometer - startMiles);

      const minDate = serviceHistory.reduce(
        (min, e) => (e.date < min ? e.date : min),
        serviceHistory[0]?.date ?? "1970-01-01",
      );
      const maxDate = serviceHistory.reduce(
        (max, e) => (e.date > max ? e.date : max),
        serviceHistory[0]?.date ?? "1970-01-01",
      );

      const years =
        (new Date(`${maxDate}T00:00:00`) - new Date(`${minDate}T00:00:00`)) /
        (1000 * 60 * 60 * 24 * 365.25);
      const safeYears = Math.max(1, years);

      const totalText = usd0.format(total);
      const cpmText = `${usdSmart(total / milesDriven)}/mi`;
      const annualText = `${usd0.format(total / safeYears)}/yr`;

      totalEls.forEach((el) => (el.innerText = totalText));
      cpmEls.forEach((el) => (el.innerText = cpmText));
      annualEls.forEach((el) => (el.innerText = annualText));

      const metaText = `Span ${fmtMonthYear(minDate)}–${fmtMonthYear(
        maxDate,
      )} • Odometer ${fmtMiles(startMiles)} → ${fmtMiles(
        currentOdometer,
      )} • ${serviceHistory.length} events`;
      metaEls.forEach((el) => (el.innerText = metaText));
    }

    // ============================================================
    // Market Condition Adjuster (Valuation Matrix calibration)
    // ============================================================
    function updateMarketCondition(multiplier) {
      const m = Number(multiplier);
      if (!Number.isFinite(m)) return;

      const pillEl = document.getElementById("market-adjustment-value");
      const labelEl = document.getElementById("market-adjustment-label");
      const multText = `${m.toFixed(2)}×`;
      if (pillEl) pillEl.innerText = multText;
      if (labelEl) labelEl.innerText = multText;

      const elTrade = document.getElementById("value-tradein");
      const elPriv = document.getElementById("value-private");
      const elRetail = document.getElementById("value-retail");
      const privCard = document.getElementById("value-private-card");

      const tradeIn = baseValues.tradeIn * m;
      const privateParty = baseValues.privateParty * m;
      const dealerRetail = baseValues.dealerRetail * m;

      if (elTrade) elTrade.innerText = usd0.format(tradeIn);
      if (elPriv) elPriv.innerText = usd0.format(privateParty);
      if (elRetail) elRetail.innerText = usd0.format(dealerRetail);

      // Visual feedback: price color shifts with market condition while keeping Private Party dominant
      if (elPriv) {
        elPriv.classList.remove("text-blue-700", "text-rose-700", "text-emerald-700");
        if (m < 0.99) elPriv.classList.add("text-rose-700");
        else if (m > 1.01) elPriv.classList.add("text-emerald-700");
        else elPriv.classList.add("text-blue-700");
      }
      if (privCard) {
        privCard.classList.remove("border-blue-300", "border-rose-300", "border-emerald-300");
        if (m < 0.99) privCard.classList.add("border-rose-300");
        else if (m > 1.01) privCard.classList.add("border-emerald-300");
        else privCard.classList.add("border-blue-300");
      }
    }

    function initMarketAdjustment() {
      const slider = document.getElementById("market-adjustment");
      if (!slider) return;

      updateMarketCondition(slider.value);
      slider.addEventListener("input", (e) => {
        updateMarketCondition(e.target.value);
      });
    }

    // ============================================================
    // Valuation Methodology tooltip (Private Party)
    // ============================================================
    const baselineBreakdown = {
      basePrivateParty: 15500,
      maintenancePremium: 2000,
    };

    function initBaselineTooltip() {
      const btn = document.getElementById("methodology-btn");
      const tip = document.getElementById("methodology-tooltip");
      if (!btn || !tip) return;

      const baseEl = document.getElementById("baseline-base");
      const premEl = document.getElementById("baseline-premium");
      const totalEl = document.getElementById("baseline-total");

      const total = baselineBreakdown.basePrivateParty + baselineBreakdown.maintenancePremium;
      if (baseEl) baseEl.innerText = usd0.format(baselineBreakdown.basePrivateParty);
      if (premEl) premEl.innerText = `+${usd0.format(baselineBreakdown.maintenancePremium)}`;
      if (totalEl) totalEl.innerText = usd0.format(total);

      const close = () => {
        tip.classList.add("hidden");
        btn.setAttribute("aria-expanded", "false");
      };
      const toggle = () => {
        const isOpen = !tip.classList.contains("hidden");
        if (isOpen) close();
        else {
          tip.classList.remove("hidden");
          btn.setAttribute("aria-expanded", "true");
        }
      };

      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        toggle();
      });

      document.addEventListener("click", (e) => {
        if (tip.classList.contains("hidden")) return;
        if (tip.contains(e.target) || btn.contains(e.target)) return;
        close();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
      });
    }

    // ============================================================
    // Mobile-first sidebar ergonomics (collapse on mobile, open on desktop)
    // ============================================================
    function initSidebarDetails() {
      const specs = document.getElementById("specs-details");
      const library = document.getElementById("library-details");
      if (!specs && !library) return;

      const mq = window.matchMedia("(min-width: 1024px)"); // lg
      const apply = (isDesktop) => {
        if (specs) specs.open = isDesktop;
        if (library) library.open = isDesktop;
      };

      apply(mq.matches);
      mq.addEventListener?.("change", (e) => apply(e.matches));
    }

    // ============================================================
    // Print Mode (Export Report)
    // ============================================================
    const PRINT_STYLE_ID = "print-mode-style";

    function enterPrintMode() {
      document.body.classList.add("print-mode");

      let style = document.getElementById(PRINT_STYLE_ID);
      if (!style) {
        style = document.createElement("style");
        style.id = PRINT_STYLE_ID;
        style.innerHTML = `
@media print {
  /* force clinical black/white output */
  html, body { background: #ffffff !important; color: #000000 !important; }
  * { color: #000000 !important; }

  /* hide non-report UI */
  nav, .no-print, .print-hide-charts, canvas { display: none !important; }

  /* expand timeline */
  .service-viewport { max-height: none !important; overflow: visible !important; }

  /* ensure no truncation utilities can hide evidence text */
  .truncate, .line-clamp-1, .line-clamp-2, .line-clamp-3, .line-clamp-4, .line-clamp-5 {
    overflow: visible !important;
    text-overflow: clip !important;
    white-space: normal !important;
    display: block !important;
    -webkit-line-clamp: unset !important;
  }

  a { color: #000000 !important; text-decoration: none !important; }
}
        `.trim();
        document.head.appendChild(style);
      }
    }

    function exitPrintMode() {
      document.body.classList.remove("print-mode");
      const style = document.getElementById(PRINT_STYLE_ID);
      if (style) style.remove();
    }

    function exportReport() {
      enterPrintMode();
      // allow style/layout to apply before opening print dialog
      setTimeout(() => window.print(), 50);
    }

    window.addEventListener("afterprint", () => {
      exitPrintMode();
    });

    let annualSpendChart;
    let mileageChart;

    function renderCharts() {
      if (typeof Chart === "undefined") return;

      // Global clinical styling
      Chart.defaults.font.family = "'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
      Chart.defaults.color = "#334155"; // slate-700

      const gridColor = "rgba(15, 23, 42, 0.08)"; // slate-900 @ low alpha
      const accentBlue = "#2563eb"; // blue-600
      const slateBar = "#1e293b"; // slate-800
      const criticalRed = "#ef4444"; // red-500

      // ----------------------------
      // Chart A: Annual Spend (Bar)
      // ----------------------------
      const byYear = new Map();
      const criticalYears = new Set();
      const outlierNotesByYear = new Map([
        [2020, "Outlier: Head Unit"],
        [2023, "Outlier: Water Leak"],
      ]);

      for (const e of serviceHistory) {
        const year = new Date(`${e.date}T00:00:00`).getFullYear();
        byYear.set(year, (byYear.get(year) || 0) + (e.cost || 0));
        if (e.type === "Critical") criticalYears.add(year);
      }

      const years = Array.from(byYear.keys()).sort((a, b) => a - b);
      const spend = years.map((y) => Number((byYear.get(y) || 0).toFixed(2)));
      const labelsA = years.map((y) =>
        outlierNotesByYear.has(y) ? `${y}*` : `${y}`,
      );
      const barColors = years.map((y) => (criticalYears.has(y) ? criticalRed : slateBar));

      const annualCtx = document.getElementById("chart-annual-spend");
      if (annualCtx) {
        if (annualSpendChart) annualSpendChart.destroy();

        annualSpendChart = new Chart(annualCtx, {
          type: "bar",
          data: {
            labels: labelsA,
            datasets: [
              {
                label: "Annual Maintenance Spend",
                data: spend,
                backgroundColor: barColors,
                borderRadius: 6,
                maxBarThickness: 42,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 2.2,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => {
                    const yearLabel = String(ctx.label).replace("*", "");
                    const yearNum = Number(yearLabel);
                    const note = outlierNotesByYear.get(yearNum);
                    return ` ${usd0.format(ctx.parsed.y)}${note ? ` • ${note}` : ""}`;
                  },
                }
              },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { color: "#64748b" }, // slate-500
              },
              y: {
                beginAtZero: true,
                grid: { color: gridColor, drawBorder: false },
                ticks: {
                  color: "#64748b",
                  callback: (v) => usd0.format(Number(v)),
                },
              },
            },
          },
        });
      }

      // ---------------------------------
      // Chart B: Mileage Accumulation (Line)
      // ---------------------------------
      const points = [...serviceHistory]
        .filter((e) => Number.isFinite(e.mileage) && e.date)
        .sort((a, b) => new Date(a.date) - new Date(b.date));

      const labels = points.map((p) => p.date);
      const miles = points.map((p) => p.mileage);

      const mileageCtx = document.getElementById("chart-mileage");
      if (mileageCtx) {
        if (mileageChart) mileageChart.destroy();

        mileageChart = new Chart(mileageCtx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "Odometer",
                data: miles,
                borderColor: accentBlue,
                backgroundColor: "rgba(37, 99, 235, 0.08)",
                pointRadius: 2,
                pointHoverRadius: 4,
                pointBackgroundColor: accentBlue,
                pointBorderWidth: 0,
                borderWidth: 2,
                tension: 0.25,
                fill: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 2.2,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => ` ${fmtMiles(ctx.parsed.y)} mi`,
                },
              },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: {
                  color: "#64748b",
                  maxRotation: 0,
                  autoSkip: true,
                  maxTicksLimit: 6,
                },
              },
              y: {
                grid: { color: gridColor, drawBorder: false },
                ticks: {
                  color: "#64748b",
                  callback: (v) => fmtMiles(v),
                },
              },
            },
          },
        });
      }
    }

    function copyVIN() {
      const vin = "JTJBM7FX0D5051070";
      const btnText = document.getElementById("vin-text");
      const original = btnText.innerText;

      const setCopiedUI = () => {
        btnText.innerText = "COPIED";
        btnText.classList.add("text-blue-600");
        setTimeout(() => {
          btnText.innerText = original;
          btnText.classList.remove("text-blue-600");
        }, 2000);
      };

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(vin).then(setCopiedUI).catch(() => {
          const dummy = document.createElement("textarea");
          document.body.appendChild(dummy);
          dummy.value = vin;
          dummy.select();
          document.execCommand("copy");
          document.body.removeChild(dummy);
          setCopiedUI();
        });
        return;
      }

      const dummy = document.createElement("textarea");
      document.body.appendChild(dummy);
      dummy.value = vin;
      dummy.select();
      document.execCommand("copy");
      document.body.removeChild(dummy);
      setCopiedUI();
    }

    renderLog();
    renderTelemetry();
    renderCharts();
    initMarketAdjustment();
    initBaselineTooltip();
    initSidebarDetails();
    lucide.createIcons();
  </script>
</body>
</html>