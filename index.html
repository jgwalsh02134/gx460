<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lexus GX 460 Archival Dashboard — JTJBM7FX0D5051070</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap');

    :root { color-scheme: light; }
    body { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    .service-viewport::-webkit-scrollbar { width: 6px; }
    .service-viewport::-webkit-scrollbar-track { background: #f8fafc; }
    .service-viewport::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    .timeline-line::before {
      content: '';
      position: absolute;
      left: 0.75rem;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: #eef2f7;
    }

    @media print {
      body { background: white !important; }
      nav, aside, .no-print, canvas { display: none !important; }
      .service-viewport { max-height: none !important; overflow: visible !important; position: static !important; }
      .print-shadow { box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
      a { color: #0f172a !important; text-decoration: none !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 selection:bg-blue-100 text-[15px] sm:text-[16px]">

  <!-- NAVBAR -->
  <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200 no-print">
    <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-2" title="Verified by Physical Records">
        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse" aria-hidden="true"></span>
        <span class="text-[10px] font-bold uppercase tracking-[0.22em] text-slate-500">Archive Status: Verified</span>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="copyVIN()" class="text-[11px] font-mono bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-md transition-colors flex items-center gap-2 border border-slate-200">
          <i data-lucide="copy" class="w-3.5 h-3.5"></i>
          <span id="vin-text">JTJBM7FX0D5051070</span>
        </button>
        <button onclick="exportReport()" class="bg-slate-900 text-white text-[11px] font-bold uppercase tracking-wider px-4 py-1.5 rounded-md hover:bg-slate-800 transition-colors flex items-center gap-2 shadow-lg shadow-slate-900/20">
          <i data-lucide="file-text" class="w-3.5 h-3.5"></i>
          Export Report
        </button>
      </div>
    </div>
  </nav>

  <!-- CONTAINER -->
  <div class="max-w-7xl mx-auto p-4 flex flex-col gap-8 lg:grid lg:grid-cols-12 lg:gap-8">

    <!-- SIDEBAR -->
    <aside class="lg:col-span-4 space-y-6 order-last lg:order-first lg:sticky lg:top-20 self-start">

      <!-- Factory Identity Card -->
      <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
        <div class="bg-slate-50 px-5 py-4 border-b border-slate-100 flex items-center justify-between">
          <h3 class="text-[11px] font-extrabold uppercase tracking-[0.22em] text-slate-700">Factory Identity</h3>
          <img src="assets/icons/lexus-1.svg" alt="Lexus Emblem" class="h-6 w-auto opacity-80" />
        </div>
        <div class="p-5 space-y-3 text-sm">
          <div class="flex items-center justify-between gap-4">
            <span class="text-slate-500">VIN</span>
            <span class="font-mono font-bold">JTJBM7FX0D5051070</span>
          </div>
          <div class="flex items-center justify-between gap-4">
            <span class="text-slate-500">Engine</span>
            <span class="font-semibold">1UR-FE 4.6L V8</span>
          </div>
          <div class="flex items-center justify-between gap-4">
            <span class="text-slate-500">Build Date</span>
            <span class="font-semibold">May 2013 (Model Year)</span>
          </div>
          <div class="flex items-center justify-between gap-4">
            <span class="text-slate-500">Build Context</span>
            <span class="inline-flex items-center gap-2 font-semibold">
              <img src="assets/icons/japan-flag.svg" alt="Japan Flag" class="w-4 h-4 rounded-sm shadow-sm object-cover" />
              Tahara Plant, Aichi (JP)
            </span>
          </div>
          <div class="flex items-center justify-between gap-4">
            <span class="text-slate-500">Paint Code</span>
            <span class="font-mono font-bold">217 <span class="font-sans font-medium text-slate-500">(Starlight Black Mica)</span></span>
          </div>
        </div>
      </section>

      <!-- Asset Verification Module -->
      <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
        <div class="bg-slate-50 px-5 py-4 border-b border-slate-100 flex items-center justify-between">
          <h3 class="text-[11px] font-extrabold uppercase tracking-[0.22em] text-slate-700">Asset Verification</h3>
          <i data-lucide="camera" class="w-4 h-4 text-slate-400" title="Real photos (click to enlarge)"></i>
        </div>
        <div class="p-5">
          <div class="grid grid-cols-3 gap-2">
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(0)" type="button">
              <img src="assets/images/real_front.jpeg" alt="Real Photo: Front" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">Front</span>
            </button>
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(1)" type="button">
              <img src="assets/images/real_rear.jpeg" alt="Real Photo: Rear" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">Rear</span>
            </button>
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(2)" type="button">
              <img src="assets/images/real_interior.png" alt="Real Photo: Interior" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">Interior</span>
            </button>
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(3)" type="button">
              <img src="assets/images/in-1.jpg" alt="Real Photo: in-1" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">IN-1</span>
            </button>
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(4)" type="button">
              <img src="assets/images/in-2.jpg" alt="Real Photo: in-2" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">IN-2</span>
            </button>
            <button class="group relative aspect-square rounded-xl overflow-hidden border border-slate-200 bg-slate-50" onclick="openLightbox(5)" type="button">
              <img src="assets/images/in-3.jpg" alt="Real Photo: in-3" class="w-full h-full object-cover" onerror="this.closest('button').classList.add('opacity-40');" />
              <span class="absolute bottom-1 left-1 text-[9px] font-bold uppercase tracking-widest text-white bg-slate-900/60 px-2 py-0.5 rounded">IN-3</span>
            </button>
          </div>
      </div>
    </section>

      <!-- Technical Library -->
      <section class="bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 shadow-2xl">
        <div class="bg-slate-800 px-5 py-4 border-b border-slate-700">
          <h3 class="text-[11px] font-extrabold uppercase tracking-[0.22em] text-white flex items-center gap-2">
            <i data-lucide="library" class="w-4 h-4 text-blue-400"></i>
            Technical Library
          </h3>
        </div>
        <div class="p-4 space-y-2">
          <a href="assets/docs/2013_lexus_gx_460_comprehensive_vehicle_overview_valuation.md" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Appraisal Summary (.md)</span>
            <i data-lucide="arrow-up-right" class="w-4 h-4 text-slate-500 group-hover:text-blue-400"></i>
          </a>
          <a href="assets/docs/Schedule%20Lexus%20Service%20Online%20%7C%20My%20Lexus.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Full Service Export (PDF)</span>
            <i data-lucide="download" class="w-4 h-4 text-slate-500 group-hover:text-emerald-400"></i>
          </a>
          <a href="assets/docs/2013_GX_460_Product_Info.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Factory Specs (PDF)</span>
            <i data-lucide="info" class="w-4 h-4 text-slate-500 group-hover:text-amber-400"></i>
          </a>
          <a href="assets/docs/OM60J63U 3.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Owner’s Manual</span>
            <i data-lucide="book-open" class="w-4 h-4 text-slate-500 group-hover:text-white"></i>
          </a>
          <a href="assets/docs/OM60J67U 2.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Navigation Manual</span>
            <i data-lucide="map" class="w-4 h-4 text-slate-500 group-hover:text-blue-400"></i>
          </a>
          <a href="assets/docs/L-ADG-0035-D.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">Glass Breakage Guide</span>
            <i data-lucide="bell-ring" class="w-4 h-4 text-slate-500 group-hover:text-slate-200"></i>
          </a>
          <a href="assets/docs/2013-lexus-gx-brochure.pdf" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-slate-800 hover:bg-slate-700 p-3 rounded-xl border border-slate-700 group transition-colors">
            <span class="text-[11px] font-semibold text-slate-200">2013 Factory Brochure</span>
            <i data-lucide="images" class="w-4 h-4 text-slate-500 group-hover:text-slate-200"></i>
          </a>
      </div>
    </section>

    </aside>

    <!-- MAIN -->
    <main class="lg:col-span-8 space-y-6">

      <!-- HERO -->
      <header class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
        <div class="grid grid-cols-1 sm:grid-cols-5 gap-0">
          <div class="sm:col-span-2 bg-white p-4 border-b sm:border-b-0 sm:border-r border-slate-100 flex items-center justify-center">
            <img src="assets/images/cc_2013lex005a_01_640_202.jpg" alt="Lexus GX 460 Stock Photo" class="w-full h-auto object-contain" />
          </div>
          <div class="sm:col-span-3 p-6 sm:p-7">
            <div class="flex flex-wrap items-center gap-2 mb-4">
              <span class="inline-flex items-center gap-2 bg-blue-50 border border-blue-100 text-blue-700 px-3 py-1 rounded-full">
                <i data-lucide="shield-check" class="w-3.5 h-3.5 text-blue-600" title="Verified by Physical Records"></i>
                <span class="text-[9px] font-extrabold uppercase tracking-widest leading-none text-blue-900">Verified Export</span>
              </span>
              <span class="inline-flex items-center gap-2 bg-emerald-50 border border-emerald-100 text-emerald-800 px-3 py-1 rounded-full" title="Verified by Physical Records">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse" aria-hidden="true"></span>
                <span class="text-[9px] font-extrabold uppercase tracking-widest leading-none">Archive Status: Verified</span>
              </span>
            </div>

            <h1 class="text-3xl lg:text-5xl font-black tracking-tight leading-none flex items-center gap-3">
              <img src="assets/icons/lexus-1.svg" alt="Lexus Emblem" class="h-6 w-auto opacity-80" />
              2013 Lexus GX 460
            </h1>

            <div class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-2 text-slate-600 text-sm">
              <span class="inline-flex items-center gap-2">
                <img src="assets/icons/japan-flag.svg" alt="Japan Flag" class="w-4 h-4 rounded-sm shadow-sm object-cover" />
                Tahara Plant, Aichi (JP)
              </span>
              <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
              <span class="font-mono">1UR-FE 4.6L V8</span>
              <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
              <span class="font-mono">Odometer: 121,600</span>
            </div>
      </div>
        </div>
      </header>

      <!-- VALUATION MATRIX -->
      <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
          <h2 class="text-[11px] font-extrabold uppercase tracking-[0.22em] text-slate-700">Valuation Matrix</h2>
          <button id="methodology-btn" type="button" class="no-print inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 border border-slate-200 transition-colors" aria-expanded="false" aria-label="Valuation methodology" title="Methodology">
            <i data-lucide="info" class="w-4 h-4 text-slate-600"></i>
          </button>
        </div>
        <div class="p-6">
          <div id="methodology-tooltip" class="no-print hidden mb-4 p-3 rounded-xl border border-slate-200 bg-white text-left shadow-lg shadow-slate-200/60" role="dialog" aria-label="Valuation methodology">
            <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">Methodology (Private Party)</div>
            <div class="space-y-1 text-[12px] text-slate-700">
              <div class="flex items-center justify-between gap-4"><span class="text-slate-500">Base Private Party</span><span class="font-mono font-bold" id="baseline-base">$15,500</span></div>
              <div class="flex items-center justify-between gap-4"><span class="text-slate-500">Maintenance Premium</span><span class="font-mono font-bold" id="baseline-premium">+$2,000</span></div>
              <div class="pt-2 mt-2 border-t border-slate-100 flex items-center justify-between gap-4"><span class="font-semibold">Total (Index 1.00×)</span><span class="font-mono font-extrabold" id="baseline-total">$17,500</span></div>
        </div>
      </div>

          <div class="grid grid-cols-3 gap-2">
            <div class="rounded-xl border border-slate-200 bg-white p-3">
              <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Trade-In</div>
              <div id="value-tradein" class="mt-1 text-lg sm:text-xl font-mono font-bold text-slate-500">$13,200</div>
              <div class="mt-1 text-[11px] text-slate-400">Liquidity Floor</div>
            </div>
            <div id="value-private-card" class="rounded-xl border-2 border-blue-300 bg-blue-50 p-3">
              <div class="text-[10px] font-black uppercase tracking-widest text-blue-900">Private Party</div>
              <div id="value-private" class="mt-1 text-xl sm:text-2xl font-mono font-extrabold text-blue-700">$17,500</div>
              <div class="mt-1 text-[11px] text-blue-700/80">Asset Target</div>
            </div>
            <div class="rounded-xl border border-slate-200 bg-white p-3">
              <div class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Dealer Retail</div>
              <div id="value-retail" class="mt-1 text-lg sm:text-xl font-mono font-bold text-emerald-700">$21,500</div>
              <div class="mt-1 text-[11px] text-slate-400">Replacement Cost</div>
      </div>
      </div>

          <div class="mt-4 no-print">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <i data-lucide="sliders-horizontal" class="w-4 h-4 text-slate-400" title="Adjusts all scenarios for local market demand"></i>
                <span class="text-[11px] font-bold uppercase tracking-widest text-slate-600">Market Condition</span>
              </div>
              <span class="text-[11px] font-mono text-slate-500" id="market-adjustment-label">1.00×</span>
            </div>
            <input id="market-adjustment" type="range" min="0.8" max="1.2" step="0.01" value="1.0" class="w-full accent-blue-600" />
            <div class="flex items-center justify-between mt-1 text-[10px] font-mono text-slate-400">
              <span>Buyer’s Market</span>
              <span>Seller’s Market</span>
            </div>
            <p class="mt-2 text-[10px] text-slate-500 font-mono text-center">Market Index: <span id="market-adjustment-value">1.00×</span></p>
      </div>
      </div>
    </section>

      <!-- TELEMETRY CHARTS -->
      <section class="grid grid-cols-1 md:grid-cols-2 gap-6 no-print">
        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
          <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <i data-lucide="bar-chart-3" class="w-4 h-4 text-blue-600"></i>
              <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Cost / Year</h3>
            </div>
            <span class="text-[10px] font-mono text-slate-400">USD</span>
          </div>
          <div class="p-4">
            <canvas id="chart-cost-year"></canvas>
            <p class="mt-3 text-[11px] text-slate-500 font-mono">Outliers: <span class="text-slate-900 font-bold">2020</span> Head Unit • <span class="text-slate-900 font-bold">2023</span> Water Leak</p>
      </div>
      </div>

        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
          <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <i data-lucide="activity" class="w-4 h-4 text-blue-600"></i>
              <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Miles / Year</h3>
            </div>
            <span class="text-[10px] font-mono text-slate-400">Δ Odometer</span>
          </div>
          <div class="p-4">
            <canvas id="chart-miles-year"></canvas>
            <p class="mt-3 text-[11px] text-slate-500 font-mono">Derived from service record mileages (sparse years may show 0).</p>
      </div>
      </div>
    </section>

      <!-- SERVICE LOG -->
      <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print-shadow">
        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i data-lucide="history" class="w-4 h-4 text-blue-600"></i>
            <h3 class="font-bold text-slate-800 uppercase tracking-widest text-[11px]">Service Archive</h3>
          </div>
          <a href="assets/docs/Schedule%20Lexus%20Service%20Online%20%7C%20My%20Lexus.pdf" target="_blank" rel="noopener noreferrer" class="text-[10px] font-bold text-slate-600 hover:underline uppercase tracking-widest no-print">Export PDF</a>
      </div>
        <div class="service-viewport p-6 relative h-auto lg:max-h-screen lg:overflow-y-auto">
          <div class="timeline-line absolute"></div>
          <div id="service-log" class="space-y-10"></div>
      </div>
    </section>

      <!-- EXTERNAL MARKET CONTEXT -->
      <section class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden no-print">
        <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
          <h3 class="text-[11px] font-extrabold uppercase tracking-[0.22em] text-slate-700">External Market Context</h3>
        </div>
        <div class="p-4 space-y-2">
          <a href="https://www.jdpower.com/cars/2013/lexus/gx" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">J.D. Power Ratings</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
          <a href="https://www.edmunds.com/lexus/gx-460/2013/review/" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">Edmunds Expert Review</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
          <a href="https://www.forbes.com/sites/jasonfogelson/2013/06/14/2013-lexus-gx-460-test-drive-and-review-driving-with-the-hobgoblin/" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">Forbes Reliability</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
          <a href="https://www.kbb.com/lexus/gx/2013/gx-460-sport-utility-4d/?vehicleid=378637&mileage=120000&offeroptions=true&modalview=false&intent=trade-in-sell&pricetype=trade-in&condition=verygood&options=6519800%7Ctrue&extcolor=black&subintent=curious&entry=defymmt" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-xl transition-colors border border-blue-100">
            <span class="text-[11px] font-bold text-blue-800">KBB Trade-In Value</span>
            <i data-lucide="trending-up" class="w-3 h-3 text-blue-600"></i>
          </a>
          <a href="https://www.carmax.com/research/lexus/gx-460/2013" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">CarMax Research</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
          <a href="https://www.kbb.com/lexus/gx/2013/" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">KBB Model Overview</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
          <a href="https://www.carfax.com/Research-2013-Lexus-GX_z1486" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors">
            <span class="text-[11px] font-bold text-slate-700">Carfax History</span>
            <i data-lucide="external-link" class="w-3 h-3 text-slate-400"></i>
          </a>
        </div>
      </section>

      <footer class="pt-6 pb-10 text-center text-slate-400">
        <p class="text-[10px] font-black uppercase tracking-[0.4em]">Automotive Archivist System</p>
        <p class="mt-2 text-[11px] italic">
          VIN <span class="font-mono">JTJBM7FX0D5051070</span> • Documented Origin: Lexus of Smithtown (2013) •
          <span class="inline-flex items-center">
            <img src="assets/icons/usa-flag.svg" alt="USA Flag" class="w-3 h-3 inline mr-1 opacity-80 align-middle" />
            US Market Spec
          </span>
        </p>
      </footer>
    </main>
  </div>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm" onclick="closeLightbox()" aria-hidden="true"></div>
    <div class="relative max-w-5xl mx-auto px-4 h-full flex items-center justify-center">
      <div class="w-full bg-white rounded-2xl overflow-hidden border border-slate-200 shadow-2xl">
        <div class="flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100">
          <div class="text-[11px] font-bold uppercase tracking-widest text-slate-600" id="lightbox-title">Photo</div>
          <div class="flex items-center gap-2">
            <button type="button" class="p-2 rounded-md hover:bg-slate-100 border border-slate-200" onclick="prevLightbox()" aria-label="Previous photo">
              <i data-lucide="chevron-left" class="w-4 h-4 text-slate-700"></i>
            </button>
            <button type="button" class="p-2 rounded-md hover:bg-slate-100 border border-slate-200" onclick="nextLightbox()" aria-label="Next photo">
              <i data-lucide="chevron-right" class="w-4 h-4 text-slate-700"></i>
            </button>
            <button type="button" class="p-2 rounded-md hover:bg-slate-100 border border-slate-200" onclick="closeLightbox()" aria-label="Close">
              <i data-lucide="x" class="w-4 h-4 text-slate-700"></i>
            </button>
          </div>
      </div>
        <div class="bg-white p-2 sm:p-4">
          <img id="lightbox-img" src="" alt="Vehicle photo" class="w-full h-auto object-contain rounded-xl bg-slate-50" />
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // Data
    // ============================================================
    const VIN = "JTJBM7FX0D5051070";
    const currentOdometer = 121600;

    const baseValues = {
      tradeIn: 13200,      // Wholesale/Liquidity Floor
      privateParty: 17500, // Core Asset Value (Current Target)
      dealerRetail: 21500  // Replacement Cost (Ceiling)
    };

    const baselineBreakdown = {
      basePrivateParty: 15500,
      maintenancePremium: 2000,
    };

    const realPhotos = [
      { src: "assets/images/real_front.jpeg", title: "Real Photo — Front" },
      { src: "assets/images/real_rear.jpeg", title: "Real Photo — Rear" },
      { src: "assets/images/real_interior.png", title: "Real Photo — Interior" },
      { src: "assets/images/in-1.jpg", title: "Real Photo — IN-1" },
      { src: "assets/images/in-2.jpg", title: "Real Photo — IN-2" },
      { src: "assets/images/in-3.jpg", title: "Real Photo — IN-3" },
    ];

    /** @type {Array<{
     *  date: string,
     *  mileage: number,
     *  type: "Routine" | "Repair" | "Upgrade" | "Critical",
     *  cost: number,
     *  notes: string,
     *  notesHtml?: string,
     *  title?: string,
     *  facility?: string,
     *  provider?: string,
     *  evidence?: boolean,
     *  observation?: string,
     *  correctiveAction?: string,
     *  valueNote?: string,
     *  archivalNote?: string,
     * }>} */
    const serviceHistory = [
      {
        date: "2024-08-29",
        mileage: 114900,
        type: "Routine",
        cost: 150.0,
        title: "Routine Service Record",
        facility: "Jiffy Lube",
        notes: "Miscellaneous service recorded.",
      },
      {
        date: "2023-08-29",
        mileage: 108112,
        type: "Critical",
        cost: 2400.0,
        title: "Water Intrusion Diagnosis & Remediation",
        provider: "New Country Lexus of Latham",
        evidence: true,
        observation:
          "Check Engine Light & 4x4 Low Light active. Found multiple codes for ECM communication loss. Discovered excessive water on passenger side dash/floor.",
        correctiveAction:
          "Removed interior to dry carpeting, padding, and sound deadening. Removed dash pad and harness. Found leak source within A-pillar. Cleaned/sealed area. Dried and verified ECUs and connectors.",
        archivalNote:
          "Archival note: this event is treated as primary disclosure evidence; see service export PDF for provenance.",
        notes:
          "Water intrusion event with multiple ECM communication loss codes; interior and harness dried; suspected A-pillar leak sealed; ECUs/connectors verified.",
      },
      {
        date: "2023-07-26",
        mileage: 107554,
        type: "Routine",
        cost: 850.0,
        title: "110,000 Mile Service Interval",
        notes:
          "Oil/filter replacement; tire rotation; NYS inspection. Major repair: rear brake pads and rotors replaced.",
      },
      {
        date: "2023-01-22",
        mileage: 103091,
        type: "Repair",
        cost: 650.0,
        title: "Park/Neutral Safety Switch Replacement",
        notes:
          "Replaced P/N Safety Switch (Part: 84540-35060). Adjusted and verified proper 4WD engagement/disengagement and vehicle starting.",
        notesHtml:
          '“Replaced P/N Safety Switch (Part: <span class="font-mono">84540-35060</span>). Adjusted and verified proper 4WD engagement/disengagement and vehicle starting.”',
      },
      {
        date: "2022-07-24",
        mileage: 97765,
        type: "Repair",
        cost: 1960.0,
        title: "Front Braking & Tire Overhaul",
        notes:
          "Replaced both front calipers, pads, and rotors. Mounted/balanced two 265/60R18 tires. Full system bleed.",
      },
      {
        date: "2020-05-03",
        mileage: 81198,
        type: "Upgrade",
        cost: 1225.0,
        title: "Navigation/Audio Head Unit Replacement",
        evidence: true,
        valueNote: "Value: $1,225+",
        notes:
          "Inspected system circuits for power/ground. Internal failure diagnosed in navigation head unit. Factory replacement unit installed. Infotainment black-out resolved.",
      },
      {
        date: "2018-01-18",
        mileage: 60960,
        type: "Routine",
        cost: 960.0,
        title: "60,000 Mile Major Service Milestone",
        notes:
          "Automatic transmission fluid flush and exchange. Cabin air filter, lubrication of drive shaft, brake fluid replacement, and battery replacement.",
      },
      {
        date: "2015-12-31",
        mileage: 30000,
        type: "Routine",
        cost: 850.0,
        title: "Standard Warranty-Era Maintenance",
        notes:
          "Regular 5k, 10k, 15k, and 30k services performed at New Country Lexus. Remote starter diagnosed/repaired (24k mi).",
      },
      {
        date: "2013-07-01",
        mileage: 2,
        type: "Routine",
        cost: 0.0,
        title: "Pre-Delivery Service (PDI)",
        facility: "Lexus of Smithtown",
        notes:
          "Original vehicle registration and pre-delivery inspection for USA all altitudes.",
      },
    ];

    // ============================================================
    // Utilities
    // ============================================================
    const usd0 = new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    function fmtMiles(n) { return Number(n).toLocaleString("en-US"); }
    function fmtMonthYear(dateStr) {
      const d = new Date(`${dateStr}T00:00:00`);
      return `${String(d.getMonth() + 1).padStart(2, "0")}/${d.getFullYear()}`;
    }
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ============================================================
    // Service Log Rendering
    // ============================================================
    function renderLog() {
      const container = document.getElementById("service-log");
      if (!container) return;

      const sorted = [...serviceHistory].sort((a, b) => new Date(b.date) - new Date(a.date));

      container.innerHTML = sorted.map((e) => {
        const meta = `${fmtMiles(e.mileage)} mi • ${fmtMonthYear(e.date)}`;
        const isCritical = e.type === "Critical";
        const dot = isCritical ? "bg-amber-500" : e.type === "Upgrade" ? "bg-blue-600" : e.type === "Repair" ? "bg-blue-500" : "bg-slate-400";
        const pill = isCritical ? "bg-amber-50 text-amber-800" : e.type === "Upgrade" ? "bg-blue-50 text-blue-800" : "bg-slate-100 text-slate-600";

        const evidenceBadge = e.evidence ? `
          <span class="inline-flex items-center gap-1 ${isCritical ? "bg-amber-100 text-amber-900 border-amber-200" : "bg-blue-100 text-blue-900 border-blue-200"} border px-2 py-0.5 rounded-full text-[9px] font-black uppercase tracking-widest">
            <i data-lucide="badge-check" class="w-3 h-3"></i> Evidence
          </span>` : "";

        const providerLine = e.facility
          ? `<p class="text-[11px] text-slate-500 uppercase tracking-wider mb-1 font-bold">Facility: ${escapeHtml(e.facility)}</p>`
          : e.provider
            ? `<p class="text-[11px] text-slate-500 uppercase tracking-wider mb-1 font-bold italic">Provider: ${escapeHtml(e.provider)}</p>`
            : "";

        const notesBlock = (e.observation && e.correctiveAction) ? `
          <div class="bg-amber-50 p-4 rounded-xl border border-amber-100 text-[13px] text-amber-900 leading-relaxed">
            <p class="font-bold mb-1">Observation:</p>
            “${escapeHtml(e.observation)}”
            <p class="font-bold mt-2 mb-1">Corrective Action:</p>
            “${escapeHtml(e.correctiveAction)}”
      </div>
          ${e.archivalNote ? `<p class="text-[11px] text-slate-500 mt-2">${escapeHtml(e.archivalNote)}</p>` : "" }
        ` : `<p class="text-[13px] text-slate-700 leading-relaxed">${e.notesHtml ? e.notesHtml : escapeHtml(e.notes)}</p>`;

        const valueLine = e.valueNote ? `<p class="text-[13px] text-slate-600 font-medium mb-1">${escapeHtml(e.valueNote)}</p>` : "";

        return `
          <div class="relative pl-10">
            <span class="absolute left-1.5 top-1.5 w-3 h-3 ${dot} rounded-full border-2 border-white z-10"></span>
            <div class="flex justify-between items-start gap-4 mb-2">
              <div class="flex items-center gap-2">
                <h4 class="font-bold text-slate-900 text-xs uppercase tracking-wider">${escapeHtml(e.title ?? "")}</h4>
                ${evidenceBadge}
      </div>
              <span class="text-[10px] font-mono px-2 py-0.5 rounded ${pill}">${escapeHtml(meta)}</span>
      </div>
            ${providerLine}
            ${valueLine}
            ${notesBlock}
      </div>
        `;
      }).join("");
    }

    // ============================================================
    // Valuation Slider
    // ============================================================
    function updateMarketCondition(multiplier) {
      const m = Number(multiplier);
      if (!Number.isFinite(m)) return;

      const multText = `${m.toFixed(2)}×`;
      const pillEl = document.getElementById("market-adjustment-value");
      const labelEl = document.getElementById("market-adjustment-label");
      if (pillEl) pillEl.innerText = multText;
      if (labelEl) labelEl.innerText = multText;

      const tradeIn = baseValues.tradeIn * m;
      const privateParty = baseValues.privateParty * m;
      const dealerRetail = baseValues.dealerRetail * m;

      const elTrade = document.getElementById("value-tradein");
      const elPriv = document.getElementById("value-private");
      const elRetail = document.getElementById("value-retail");
      const privCard = document.getElementById("value-private-card");

      if (elTrade) elTrade.innerText = usd0.format(tradeIn);
      if (elPriv) elPriv.innerText = usd0.format(privateParty);
      if (elRetail) elRetail.innerText = usd0.format(dealerRetail);

      if (privCard && elPriv) {
        elPriv.classList.remove("text-blue-700", "text-rose-700", "text-emerald-700");
        privCard.classList.remove("border-blue-300", "border-rose-300", "border-emerald-300");
        if (m < 0.99) { elPriv.classList.add("text-rose-700"); privCard.classList.add("border-rose-300"); }
        else if (m > 1.01) { elPriv.classList.add("text-emerald-700"); privCard.classList.add("border-emerald-300"); }
        else { elPriv.classList.add("text-blue-700"); privCard.classList.add("border-blue-300"); }
      }
    }

    function initMarketAdjustment() {
      const slider = document.getElementById("market-adjustment");
      if (!slider) return;
      updateMarketCondition(slider.value);
      slider.addEventListener("input", (e) => updateMarketCondition(e.target.value));
    }

    // ============================================================
    // Methodology Tooltip
    // ============================================================
    function initMethodologyTooltip() {
      const btn = document.getElementById("methodology-btn");
      const tip = document.getElementById("methodology-tooltip");
      if (!btn || !tip) return;

      const baseEl = document.getElementById("baseline-base");
      const premEl = document.getElementById("baseline-premium");
      const totalEl = document.getElementById("baseline-total");

      const total = baselineBreakdown.basePrivateParty + baselineBreakdown.maintenancePremium;
      if (baseEl) baseEl.innerText = usd0.format(baselineBreakdown.basePrivateParty);
      if (premEl) premEl.innerText = `+${usd0.format(baselineBreakdown.maintenancePremium)}`;
      if (totalEl) totalEl.innerText = usd0.format(total);

      const close = () => { tip.classList.add("hidden"); btn.setAttribute("aria-expanded", "false"); };
      const toggle = () => {
        const isOpen = !tip.classList.contains("hidden");
        if (isOpen) close();
        else { tip.classList.remove("hidden"); btn.setAttribute("aria-expanded", "true"); }
      };

      btn.addEventListener("click", (e) => { e.stopPropagation(); toggle(); });
      document.addEventListener("click", (e) => { if (!tip.classList.contains("hidden") && !tip.contains(e.target) && !btn.contains(e.target)) close(); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") close(); });
    }

    // ============================================================
    // Charts
    // ============================================================
    let chartCostYear;
    let chartMilesYear;

    function renderCharts() {
      if (typeof Chart === "undefined") return;

      Chart.defaults.font.family = "'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
      Chart.defaults.color = "#334155";

      const gridColor = "rgba(15, 23, 42, 0.08)";
      const slateBar = "#1e293b";
      const accentBlue = "#2563eb";
      const criticalRed = "#ef4444";

      // Cost / Year
      const byYearCost = new Map();
      const criticalYears = new Set();
      const outlierNotesByYear = new Map([[2020, "Outlier: Head Unit"], [2023, "Outlier: Water Leak"]]);

      for (const e of serviceHistory) {
        const y = new Date(`${e.date}T00:00:00`).getFullYear();
        byYearCost.set(y, (byYearCost.get(y) || 0) + (e.cost || 0));
        if (e.type === "Critical") criticalYears.add(y);
      }

      const years = Array.from(byYearCost.keys()).sort((a,b) => a-b);
      const labelsCost = years.map((y) => outlierNotesByYear.has(y) ? `${y}*` : `${y}`);
      const dataCost = years.map((y) => Math.round(byYearCost.get(y) || 0));
      const colorsCost = years.map((y) => criticalYears.has(y) ? criticalRed : slateBar);

      const ctxA = document.getElementById("chart-cost-year");
      if (ctxA) {
        chartCostYear?.destroy();
        chartCostYear = new Chart(ctxA, {
          type: "bar",
          data: { labels: labelsCost, datasets: [{ data: dataCost, backgroundColor: colorsCost, borderRadius: 6, maxBarThickness: 44 }] },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => {
                    const y = Number(String(ctx.label).replace("*",""));
                    const note = outlierNotesByYear.get(y);
                    return ` ${usd0.format(ctx.parsed.y)}${note ? ` • ${note}` : ""}`;
                  }
                }
              }
            },
            scales: {
              x: { grid: { display: false }, ticks: { color: "#64748b" } },
              y: { beginAtZero: true, grid: { color: gridColor, drawBorder: false }, ticks: { color: "#64748b", callback: (v) => usd0.format(v) } }
            }
          }
        });
      }

      // Miles / Year (Δ based on min/max per year in dataset)
      const byYearMinMax = new Map(); // year -> {min,max}
      for (const e of serviceHistory) {
        const y = new Date(`${e.date}T00:00:00`).getFullYear();
        const mm = byYearMinMax.get(y) || { min: e.mileage, max: e.mileage };
        mm.min = Math.min(mm.min, e.mileage);
        mm.max = Math.max(mm.max, e.mileage);
        byYearMinMax.set(y, mm);
      }
      const yearsMiles = Array.from(byYearMinMax.keys()).sort((a,b) => a-b);
      const dataMiles = yearsMiles.map((y) => Math.max(0, (byYearMinMax.get(y).max - byYearMinMax.get(y).min)));

      const ctxB = document.getElementById("chart-miles-year");
      if (ctxB) {
        chartMilesYear?.destroy();
        chartMilesYear = new Chart(ctxB, {
          type: "line",
          data: {
            labels: yearsMiles.map(String),
            datasets: [{
              data: dataMiles,
              borderColor: accentBlue,
              backgroundColor: "rgba(37, 99, 235, 0.08)",
              borderWidth: 2,
              pointRadius: 2,
              tension: 0.25
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: { callbacks: { label: (ctx) => ` ${fmtMiles(ctx.parsed.y)} mi` } }
            },
            scales: {
              x: { grid: { display: false }, ticks: { color: "#64748b", maxTicksLimit: 6 } },
              y: { beginAtZero: true, grid: { color: gridColor, drawBorder: false }, ticks: { color: "#64748b", callback: (v) => fmtMiles(v) } }
            }
          }
        });
      }
    }

    // ============================================================
    // Lightbox
    // ============================================================
    let lightboxIndex = 0;

    function openLightbox(idx) {
      lightboxIndex = idx;
      const modal = document.getElementById("lightbox");
      const img = document.getElementById("lightbox-img");
      const title = document.getElementById("lightbox-title");
      if (!modal || !img || !title) return;

      const item = realPhotos[lightboxIndex];
      img.src = item.src;
      title.innerText = item.title;
      modal.classList.remove("hidden");
      document.body.style.overflow = "hidden";
      lucide.createIcons();
    }

    function closeLightbox() {
      const modal = document.getElementById("lightbox");
      if (!modal) return;
      modal.classList.add("hidden");
      document.body.style.overflow = "";
    }

    function prevLightbox() {
      lightboxIndex = (lightboxIndex - 1 + realPhotos.length) % realPhotos.length;
      openLightbox(lightboxIndex);
    }

    function nextLightbox() {
      lightboxIndex = (lightboxIndex + 1) % realPhotos.length;
      openLightbox(lightboxIndex);
    }

    document.addEventListener("keydown", (e) => {
      const modal = document.getElementById("lightbox");
      if (!modal || modal.classList.contains("hidden")) return;
      if (e.key === "Escape") closeLightbox();
      if (e.key === "ArrowLeft") prevLightbox();
      if (e.key === "ArrowRight") nextLightbox();
    });

    // ============================================================
    // Copy VIN
    // ============================================================
    function copyVIN() {
      const btnText = document.getElementById("vin-text");
      const original = btnText?.innerText ?? VIN;
      const setCopiedUI = () => {
        if (!btnText) return;
        btnText.innerText = "COPIED";
        btnText.classList.add("text-blue-600");
        setTimeout(() => {
          btnText.innerText = original;
          btnText.classList.remove("text-blue-600");
        }, 1600);
      };

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(VIN).then(setCopiedUI).catch(() => {});
        return;
      }

      const dummy = document.createElement("textarea");
      document.body.appendChild(dummy);
      dummy.value = VIN;
      dummy.select();
      document.execCommand("copy");
      document.body.removeChild(dummy);
      setCopiedUI();
    }

    // ============================================================
    // Print Mode
    // ============================================================
    const PRINT_STYLE_ID = "print-mode-style";
    function enterPrintMode() {
      let style = document.getElementById(PRINT_STYLE_ID);
      if (style) return;
      style = document.createElement("style");
      style.id = PRINT_STYLE_ID;
      style.innerHTML = `
@media print {
  html, body { background: #ffffff !important; color: #000000 !important; }
  * { color: #000000 !important; }
  nav, aside, .no-print, canvas { display: none !important; }
  .service-viewport { max-height: none !important; overflow: visible !important; position: static !important; }
}
      `.trim();
      document.head.appendChild(style);
    }
    function exitPrintMode() {
      const style = document.getElementById(PRINT_STYLE_ID);
      if (style) style.remove();
    }
    function exportReport() {
      enterPrintMode();
      setTimeout(() => window.print(), 50);
    }
    window.addEventListener("afterprint", exitPrintMode);

    // ============================================================
    // Init
    // ============================================================
    renderLog();
    initMarketAdjustment();
    initMethodologyTooltip();
    renderCharts();
    lucide.createIcons();
  </script>
</body>
</html>
